<!-- User Settings -->
<script>
</script>

<!-- Javascript Functions -->
<script>
  function appendHTML(element, contents) {
    document.getElementById(element).innerHTML=(document.getElementById(element).innerHTML + contents)
  }
  function insertHTML(element, contents) {
    document.getElementById(element).innerHTML=(contents + document.getElementById(element).innerHTML)
  }
</script>

<%# Ruby pre-render functions %>
<%# calculate when start of service year was %>
<% if Time.now.month>=9 %>
  <% svcYearStart=Time.new(Time.now.year,9,1) %>
<% else %>
  <% svcYearStart=Time.new(Time.now.year-1,9,1) %>
<% end %>
<%# calculate how many territories completed during service year %>
<% compCurYear=0 %>
<% @terrs.each do |terr| %>
  <% if terr.datecomp > svcYearStart then compCurYear+=1 end %>
<% end %>
<%# If current month is Sep do the same for last service year for record keeping %>
<% lastSvcYear=false %>
<% if Time.now.month==9 %>
  <% lastSvcYear=Time.new(svcYearStart.year-1,9,1) %>
  <% compLastYear=0 %>
  <% @terrs.each do |terr| %>
    <% if terr.datecomp>lastSvcYear && terr.datecomp<svcYearStart then compLastYear+=1 end %>
  <% end %>
<% end %>
<div id="svcYearStats">
  <table>
    <thead>
      <tr>
        <th>Year</th>
        <th>Completed</th>
        <th>Total</th>
        <th>Percent</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><%= svcYearStart.year %></td>
        <td><%= compCurYear %></td>
        <td><%= @terrs.length %></td>
        <td><%= compCurYear.to_f/@terrs.length %></td>
      </tr>
      <% if lastSvcYear %>
        <tr>
          <td><%= lastSvcYear.year %></td>
          <td><%= compLastYear %></td>
          <td><%= @terrs.length %></td>
          <td><%= compLastYear.to_f/@terrs.length %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
